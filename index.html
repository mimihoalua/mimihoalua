<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MimiFlower - Thế Giới Hoa Lụa & Decor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        /* Tùy chỉnh thanh cuộn cho giống Shopee */
        .variant-scroll::-webkit-scrollbar { width: 6px; }
        .variant-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .variant-scroll::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .variant-scroll::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* Hiệu ứng nảy cho giỏ hàng */
        @keyframes bounce-short {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        .animate-bounce-short { animation: bounce-short 0.3s ease-in-out; }

        /* Font chữ Shopee-like */
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

    <header class="bg-gradient-to-r from-[#ee4d2d] to-[#ff7337] shadow-md sticky top-0 z-40 text-white">
        <div class="container mx-auto px-2 md:px-4">
            <div class="flex justify-between items-center text-xs md:text-sm py-1 border-b border-white/20 mb-2">
                <div class="flex gap-4">
                    <a href="#" class="hover:text-gray-200">Kênh Người Bán</a>
                    <a href="#" class="hover:text-gray-200">Tải ứng dụng</a>
                </div>
                <div class="flex gap-4">
                    <a href="#" class="hover:text-gray-200">Thông báo</a>
                    <a href="#" class="hover:text-gray-200">Hỗ trợ</a>
                </div>
            </div>

            <div class="flex items-center gap-4 py-2 pb-3">
                <a href="#" class="flex items-center gap-2 font-bold text-xl md:text-2xl tracking-tighter whitespace-nowrap">
                    <i class="fa-solid fa-leaf"></i> MimiFlower
                </a>

                <div class="flex-1 max-w-2xl relative mx-2">
                    <input type="text" id="searchInput" placeholder="Tìm cây giả, hoa lụa, decor tết..." 
                           class="w-full pl-4 pr-10 py-2 rounded-sm text-gray-800 focus:outline-none shadow-sm text-sm">
                    <button class="absolute right-1 top-1 bottom-1 bg-[#fb5533] px-4 rounded-sm text-white hover:opacity-90">
                        <i class="fa-solid fa-search"></i>
                    </button>
                </div>

                <div class="relative px-2 cursor-pointer group" onclick="shakeCart()">
                    <i class="fa-solid fa-cart-shopping text-2xl md:text-3xl"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-white text-[#ee4d2d] text-xs font-bold px-1.5 py-0.5 rounded-full border border-[#ee4d2d] shadow-sm">0</span>
                    
                    <div class="absolute right-0 top-full mt-2 w-64 bg-white text-gray-800 shadow-xl rounded border hidden group-hover:block z-50 p-4 text-center text-sm">
                        <div class="text-gray-400 mb-2">Sản phẩm mới thêm</div>
                        <img src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/cart/9bdd8040b334d31946f4.png" class="mx-auto w-16 opacity-50">
                        <div class="mt-2 text-xs text-gray-400">Chưa có sản phẩm</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav class="bg-white shadow-sm border-b sticky top-[75px] z-30 hidden md:block">
        <div class="container mx-auto px-4 flex gap-8 text-sm font-medium text-gray-700 overflow-x-auto">
            <a href="#" class="py-3 text-[#ee4d2d] border-b-2 border-[#ee4d2d]">Trang Chủ</a>
            <a href="#" class="py-3 hover:text-[#ee4d2d] transition">Cây Giả Decor</a>
            <a href="#" class="py-3 hover:text-[#ee4d2d] transition">Hoa Lụa Cao Cấp</a>
            <a href="#" class="py-3 hover:text-[#ee4d2d] transition">Phụ Kiện Tết</a>
            <a href="#" class="py-3 hover:text-[#ee4d2d] transition">Chính Sách Bảo Hành</a>
        </div>
    </nav>

    <main class="container mx-auto px-2 md:px-4 py-6 flex-grow">
        <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between border-l-4 border-[#ee4d2d]">
            <div>
                <h2 class="text-lg font-bold text-gray-800">GỢI Ý HÔM NAY</h2>
                <p class="text-xs text-gray-500">Cập nhật các mẫu cây giả, hoa lụa hot nhất</p>
            </div>
            <a href="#" class="text-[#ee4d2d] text-sm font-medium hover:underline">Xem tất cả ></a>
        </div>

        <div id="productGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-2 md:gap-4">
            <div class="bg-white rounded shadow-sm p-2 animate-pulse h-64"></div>
            <div class="bg-white rounded shadow-sm p-2 animate-pulse h-64"></div>
            <div class="bg-white rounded shadow-sm p-2 animate-pulse h-64"></div>
            <div class="bg-white rounded shadow-sm p-2 animate-pulse h-64"></div>
        </div>
    </main>

    <footer class="bg-[#2d2d2d] text-white pt-8 pb-4 mt-auto border-t-4 border-[#ee4d2d]">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center md:items-start gap-6 text-center md:text-left">
                <div class="md:w-1/3">
                    <h3 class="text-xl font-bold text-[#ee4d2d] mb-2 font-serif italic">MIMIHOALUA</h3>
                    <p class="text-gray-400 text-xs leading-relaxed">
                        Chuyên cung cấp sỉ lẻ hoa lụa, cây giả trang trí nội thất, sự kiện. Mang thiên nhiên vào không gian sống của bạn.
                    </p>
                </div>

                <div class="md:w-1/3">
                    <h4 class="text-sm font-bold uppercase mb-3 text-gray-300">Kết nối với chúng tôi</h4>
                    <div class="flex justify-center md:justify-start gap-4">
                        <a href="https://zalo.me/0348211187" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded text-xs font-bold flex items-center gap-2 transition">
                            <i class="fa-solid fa-comment"></i> ZALO Chat
                        </a>
                        <a href="https://tiktok.com/@mimishophoalua" target="_blank" class="bg-black border border-gray-600 hover:border-white text-white px-3 py-1.5 rounded text-xs font-bold flex items-center gap-2 transition">
                            <i class="fa-brands fa-tiktok"></i> TikTok
                        </a>
                    </div>
                </div>

                <div class="md:w-1/3 text-xs text-gray-400 space-y-1">
                    <p><i class="fa-solid fa-phone text-[#ee4d2d] mr-2"></i> Hotline: 0348.211.187</p>
                    <p><i class="fa-solid fa-envelope text-[#ee4d2d] mr-2"></i> thamnguyen987@gmail.com</p>
                    <p><i class="fa-solid fa-location-dot text-[#ee4d2d] mr-2"></i> Số 3 Ngõ Văn Chỉ 1, Thôn Phù Mã, Xã Sóc Sơn, TP. Hà Nội</p>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-6 pt-4 text-center text-[10px] text-gray-500">
                © 2025 MIMIHOALUA. ALL RIGHTS RESERVED. Designed for Shopee Style.
            </div>
        </div>
    </footer>

    <div id="detailModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center p-0 md:p-4 backdrop-blur-sm transition-opacity duration-300 opacity-0">
        <div class="bg-white w-full md:w-[900px] h-full md:h-[90vh] md:rounded-lg shadow-2xl flex flex-col md:flex-row overflow-hidden relative transform scale-95 transition-transform duration-300" id="modalContent">
            
            <button onclick="closeDetail()" class="absolute top-2 right-2 z-20 w-8 h-8 bg-gray-100/80 rounded-full text-gray-500 flex items-center justify-center hover:bg-gray-200">
                <i class="fa-solid fa-times"></i>
            </button>

            <div class="w-full md:w-[45%] bg-white flex flex-col border-r border-gray-100 h-full">
                <div class="aspect-square w-full bg-gray-50 relative shrink-0">
                    <img id="modalMainImg" src="" class="absolute inset-0 w-full h-full object-contain p-1">
                    <div class="absolute bottom-2 left-0 right-0 text-center">
                        <span class="bg-black/50 text-white text-[10px] px-2 py-1 rounded-full backdrop-blur-sm">Hình ảnh thực tế từ Shop</span>
                    </div>
                </div>

                <div class="p-4 flex flex-col gap-3 bg-gray-50 flex-grow justify-center border-t shadow-inner">
                    <div class="text-center">
                        <div class="text-xs text-gray-500 mb-1">Mẫu đang chọn: <span id="selectedVariantName" class="font-bold text-gray-800">...</span></div>
                        <div id="modalPrice" class="text-3xl font-bold text-[#ee4d2d]">-- ₫</div>
                    </div>

                    <div class="flex flex-col gap-3 mt-2">
                        <div class="flex items-center justify-center gap-2">
                            <span class="text-sm text-gray-500">Số lượng:</span>
                            <div class="flex items-center border border-gray-300 rounded">
                                <button onclick="updateQty(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 text-gray-600">-</button>
                                <input id="qtyInput" type="number" value="1" class="w-10 h-8 text-center text-sm border-x border-gray-300 focus:outline-none" readonly>
                                <button onclick="updateQty(1)" class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 text-gray-600">+</button>
                            </div>
                        </div>

                        <button onclick="addToCart()" class="w-full bg-[#ee4d2d]/10 border border-[#ee4d2d] text-[#ee4d2d] hover:bg-[#ee4d2d]/20 font-bold py-3 px-4 rounded shadow-sm flex items-center justify-center gap-2 transition active:scale-95">
                            <i class="fa-solid fa-cart-plus"></i> Thêm Vào Giỏ Hàng
                        </button>
                        
                        <button class="w-full bg-[#ee4d2d] text-white font-bold py-3 px-4 rounded shadow-sm hover:bg-[#d73211] transition text-sm">
                            Mua Ngay
                        </button>
                    </div>
                </div>
            </div>

            <div class="w-full md:w-[55%] flex flex-col h-full bg-white relative">
                <div class="p-4 border-b sticky top-0 bg-white z-10 shadow-sm">
                    <h2 id="modalTitle" class="text-lg font-medium text-gray-800 leading-snug line-clamp-2 pr-6">Tên sản phẩm...</h2>
                </div>

                <div class="p-4 overflow-y-auto variant-scroll flex-1 pb-20 md:pb-4">
                    <h3 class="text-sm text-gray-500 mb-3">Phân loại hàng:</h3>
                    
                    <div id="variantGrid" class="grid grid-cols-3 gap-2">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-20 right-4 bg-green-600 text-white px-6 py-3 rounded shadow-2xl transform translate-x-full transition-transform duration-300 z-[60] flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-xl"></i>
        <div>
            <div class="font-bold text-sm">Thành công!</div>
            <div class="text-xs">Sản phẩm đã được thêm vào giỏ.</div>
        </div>
    </div>

    <script>
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDT0IEKhjAJZ_ZiMVwVCvO-fuj0ByReoE8",
            authDomain: "esomar-vnn.firebaseapp.com",
            projectId: "esomar-vnn",
            storageBucket: "esomar-vnn.firebasestorage.app",
            messagingSenderId: "1023271897973",
            appId: "1:1023271897973:web:c7207b0e8321fc271fe13c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- 2. STATE MANAGEMENT ---
        let currentProduct = null;
        let selectedVariantIndex = 0;
        let cartTotal = parseInt(localStorage.getItem('mimi_cart_count')) || 0;

        // Init Cart UI
        updateCartUI();

        // --- 3. LOAD PRODUCTS ---
        db.collection("products").orderBy("createdAt", "desc").onSnapshot((snapshot) => {
            const grid = document.getElementById("productGrid");
            grid.innerHTML = "";
            
            snapshot.forEach(doc => {
                const p = doc.data();
                p.id = doc.id;
                
                // Logic ảnh đại diện
                let thumb = "https://via.placeholder.com/300?text=No+Image";
                if (p.variants && p.variants.length > 0 && p.variants[0].image) thumb = p.variants[0].image;
                else if (p.images && p.images.length > 0) thumb = p.images[0];

                // Logic hiển thị giá
                let priceDisplay = new Intl.NumberFormat('vi-VN').format(p.basePrice);
                if (p.variants && p.variants.length > 1) {
                    const prices = p.variants.map(v => v.price);
                    const min = Math.min(...prices);
                    const max = Math.max(...prices);
                    if(min !== max) priceDisplay = `${new Intl.NumberFormat('vi-VN').format(min)} - ${new Intl.NumberFormat('vi-VN').format(max)}`;
                }

                // Create Card HTML
                const card = document.createElement('div');
                card.className = "bg-white rounded-sm shadow-sm hover:shadow-md transition duration-200 cursor-pointer border border-transparent hover:border-[#ee4d2d] flex flex-col h-full";
                card.onclick = () => openDetail(p);
                
                card.innerHTML = `
                    <div class="aspect-square w-full relative overflow-hidden bg-gray-100">
                        <img src="${thumb}" class="w-full h-full object-cover" loading="lazy">
                        ${p.variants && p.variants.length > 1 ? '<div class="absolute bottom-0 right-0 bg-black/60 text-white text-[10px] px-1">Nhiều mẫu</div>' : ''}
                        
                        <div class="absolute top-0 left-0 bg-[#ee4d2d] text-white text-[10px] font-bold px-2 py-0.5 rounded-br">
                            Yêu thích
                        </div>
                    </div>
                    <div class="p-2 flex flex-col flex-1">
                        <div class="line-clamp-2 text-xs md:text-sm text-gray-800 mb-2 leading-tight min-h-[32px]">
                            ${p.name}
                        </div>
                        <div class="mt-auto flex items-center justify-between">
                            <span class="text-[#ee4d2d] font-bold text-sm md:text-base">₫${priceDisplay}</span>
                            <span class="text-[10px] text-gray-400">Đã bán 1.2k</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        });

        // --- 4. MODAL LOGIC (The "H2" Layout) ---
        function openDetail(product) {
            currentProduct = product;
            selectedVariantIndex = 0; // Reset
            document.getElementById("qtyInput").value = 1;

            const modal = document.getElementById("detailModal");
            const content = document.getElementById("modalContent");
            const variantGrid = document.getElementById("variantGrid");
            
            // Fill Info
            document.getElementById("modalTitle").innerText = product.name;
            
            // Render Variants
            variantGrid.innerHTML = "";
            if (product.variants && product.variants.length > 0) {
                renderVariants(product.variants);
                selectVariant(0); // Auto select first
            } else {
                // Sản phẩm đơn
                document.getElementById("modalMainImg").src = product.images[0] || "https://via.placeholder.com/300";
                document.getElementById("modalPrice").innerText = new Intl.NumberFormat('vi-VN').format(product.basePrice) + ' ₫';
                document.getElementById("selectedVariantName").innerText = "Mặc định";
                variantGrid.innerHTML = '<span class="text-gray-400 text-sm col-span-3 text-center py-4">Sản phẩm này không có phân loại.</span>';
            }

            // Show Modal with Animation
            modal.classList.remove("hidden");
            requestAnimationFrame(() => {
                modal.classList.remove("opacity-0");
                content.classList.remove("scale-95");
                content.classList.add("scale-100");
            });
        }

        function renderVariants(variants) {
            const grid = document.getElementById("variantGrid");
            grid.innerHTML = "";
            variants.forEach((v, index) => {
                const btn = document.createElement("div");
                btn.className = "cursor-pointer border rounded-sm p-1 hover:border-[#ee4d2d] transition flex flex-col gap-1 group bg-gray-50 variant-item";
                btn.onclick = () => selectVariant(index);
                
                // Ảnh biến thể
                const imgUrl = v.image || currentProduct.images[0] || "https://via.placeholder.com/100";
                
                btn.innerHTML = `
                    <div class="w-full aspect-square rounded-sm overflow-hidden relative border border-gray-200">
                        <img src="${imgUrl}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition"></div>
                    </div>
                    <span class="text-[11px] text-center w-full truncate px-1 text-gray-700 leading-tight">${v.name}</span>
                `;
                grid.appendChild(btn);
            });
        }

        function selectVariant(index) {
            selectedVariantIndex = index;
            const v = currentProduct.variants[index];
            
            // Update Left Column Info
            document.getElementById("modalMainImg").src = v.image || currentProduct.images[0];
            document.getElementById("modalPrice").innerText = new Intl.NumberFormat('vi-VN').format(v.price) + ' ₫';
            document.getElementById("selectedVariantName").innerText = v.name;

            // Highlight selected button
            const btns = document.querySelectorAll(".variant-item");
            btns.forEach((b, i) => {
                if (i === index) {
                    b.classList.add("border-[#ee4d2d]", "bg-[#ee4d2d]/5");
                    b.querySelector("span").classList.add("text-[#ee4d2d]", "font-bold");
                } else {
                    b.classList.remove("border-[#ee4d2d]", "bg-[#ee4d2d]/5");
                    b.querySelector("span").classList.remove("text-[#ee4d2d]", "font-bold");
                }
            });
        }

        function closeDetail() {
            const modal = document.getElementById("detailModal");
            const content = document.getElementById("modalContent");
            
            modal.classList.add("opacity-0");
            content.classList.remove("scale-100");
            content.classList.add("scale-95");
            
            setTimeout(() => {
                modal.classList.add("hidden");
            }, 300);
        }

        // --- 5. CART ACTIONS & FEEDBACK ---
        function updateQty(change) {
            const input = document.getElementById("qtyInput");
            let val = parseInt(input.value) + change;
            if (val < 1) val = 1;
            input.value = val;
        }

        function addToCart() {
            const qty = parseInt(document.getElementById("qtyInput").value);
            cartTotal += qty;
            
            // 1. Lưu LocalStorage
            localStorage.setItem('mimi_cart_count', cartTotal);
            
            // 2. Update UI Badge
            updateCartUI();
            
            // 3. Hiệu ứng Rung (Vibration API) - Chỉ chạy trên Mobile
            if (navigator.vibrate) {
                navigator.vibrate(200); 
            }

            // 4. Hiệu ứng Toast Notification
            showToast();

            // 5. Đóng Modal
            closeDetail();
        }

        function updateCartUI() {
            const badge = document.getElementById("cartCount");
            badge.innerText = cartTotal > 99 ? '99+' : cartTotal;
            
            // Bounce Animation
            badge.classList.remove("animate-bounce-short");
            void badge.offsetWidth; // Trigger reflow
            badge.classList.add("animate-bounce-short");
        }

        function showToast() {
            const toast = document.getElementById("toast");
            toast.classList.remove("translate-x-full");
            setTimeout(() => {
                toast.classList.add("translate-x-full");
            }, 3000);
        }

        // Close modal on click outside
        document.getElementById("detailModal").addEventListener("click", (e) => {
            if (e.target === document.getElementById("detailModal")) closeDetail();
        });
    </script>
</body>
</html>
