<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MimiManager Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <style>
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f3f4f6; }
        .active-nav { background-color: #fff1f2; color: #ee4d2d; border-right: 3px solid #ee4d2d; font-weight: bold; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #ee4d2d; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mobile Sidebar Animation */
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .sidebar-closed { transform: translateX(-100%); }
        .sidebar-open { transform: translateX(0); }

        /* Print Styles */
        @media print {
            body * { visibility: hidden; }
            #printSection, #printSection * { visibility: visible; }
            #printSection { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-gray-800">

    <!-- 1. LOGIN OVERLAY -->
    <div id="loginOverlay" class="fixed inset-0 bg-gray-900 z-[100] flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm mx-4 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-[#ee4d2d]"></div>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-[#ee4d2d] shadow-sm">
                    <i class="fa-solid fa-store text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">K√™nh Ng∆∞·ªùi B√°n</h2>
                <p class="text-gray-500 text-sm">Qu·∫£n l√Ω MimiFlower Shop</p>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div><label class="block text-sm font-medium text-gray-700">T√†i kho·∫£n</label><input type="text" id="username" class="w-full border p-2.5 rounded focus:border-[#ee4d2d] outline-none mt-1" placeholder="admin"></div>
                <div><label class="block text-sm font-medium text-gray-700">M·∫≠t kh·∫©u</label><input type="password" id="password" class="w-full border p-2.5 rounded focus:border-[#ee4d2d] outline-none mt-1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <button type="submit" class="w-full bg-[#ee4d2d] text-white py-2.5 rounded font-bold hover:bg-[#d73211] transition shadow-lg shadow-orange-500/30">ƒêƒÉng Nh·∫≠p</button>
            </form>
        </div>
    </div>

    <!-- 2. SIDEBAR (SMART MENU) -->
    <div id="sidebar" class="fixed md:static inset-y-0 left-0 w-72 bg-white border-r border-gray-200 flex flex-col z-40 sidebar-transition sidebar-closed md:transform-none shadow-2xl md:shadow-none">
        <div class="p-4 border-b border-gray-100 flex items-center justify-between h-16">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-leaf text-[#ee4d2d] text-xl"></i>
                <span class="font-bold text-xl tracking-tight text-gray-800">MimiManager</span>
            </div>
            <button onclick="toggleSidebar()" class="md:hidden text-gray-500 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button>
        </div>
        
        <nav class="flex-1 py-4 space-y-1 overflow-y-auto">
            <a href="#" onclick="switchTab('dashboard'); toggleSidebar()" id="nav-dashboard" class="flex items-center gap-3 px-6 py-3.5 text-gray-600 hover:bg-gray-50 transition active-nav">
                <i class="fa-solid fa-chart-line w-5 text-center"></i> T·ªïng Quan
            </a>
            <a href="#" onclick="switchTab('orders'); toggleSidebar()" id="nav-orders" class="flex items-center gap-3 px-6 py-3.5 text-gray-600 hover:bg-gray-50 transition">
                <i class="fa-solid fa-clipboard-list w-5 text-center"></i> ƒê∆°n H√†ng 
                <span id="badgeNewOrders" class="hidden ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold">0</span>
            </a>
            <a href="#" onclick="switchTab('products'); toggleSidebar()" id="nav-products" class="flex items-center gap-3 px-6 py-3.5 text-gray-600 hover:bg-gray-50 transition">
                <i class="fa-solid fa-box w-5 text-center"></i> S·∫£n Ph·∫©m
            </a>
        </nav>
        
        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 rounded-full bg-white border flex items-center justify-center text-gray-500 shadow-sm"><i class="fa-solid fa-user-shield"></i></div>
                <div><div class="font-bold text-sm text-gray-800">Admin</div><div class="text-xs text-gray-500 text-green-600 flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> Online</div></div>
            </div>
            <button onclick="logout()" class="flex items-center justify-center gap-2 text-red-600 bg-white border border-red-200 py-2 rounded w-full hover:bg-red-50 text-sm font-bold shadow-sm transition">
                <i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t
            </button>
        </div>
    </div>

    <!-- BACKDROP -->
    <div id="sidebarBackdrop" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden glass-effect"></div>

    <!-- 3. MAIN CONTENT -->
    <div class="flex-1 flex flex-col h-full overflow-hidden bg-[#f8fafc] w-full">
        
        <!-- MOBILE HEADER -->
        <div class="md:hidden h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 shrink-0 shadow-sm z-20">
            <button onclick="toggleSidebar()" class="text-gray-700 hover:text-[#ee4d2d]"><i class="fa-solid fa-bars text-2xl"></i></button>
            <span class="font-bold text-lg text-gray-800">Qu·∫£n L√Ω Shop</span>
            <div class="w-8"></div>
        </div>

        <!-- CONTENT AREA -->
        <div class="flex-1 overflow-hidden relative">
            
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard" class="p-4 md:p-8 overflow-y-auto h-full pb-20 custom-scrollbar">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">T·ªïng Quan H√¥m Nay</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                        <div class="text-gray-400 text-xs uppercase font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-sack-dollar text-green-500"></i> Doanh thu</div>
                        <div class="text-2xl font-bold text-gray-800" id="statRevenue">0‚Ç´</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                        <div class="text-gray-400 text-xs uppercase font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-cart-shopping text-blue-500"></i> ƒê∆°n m·ªõi</div>
                        <div class="text-2xl font-bold text-gray-800" id="statNewOrders">0</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                        <div class="text-gray-400 text-xs uppercase font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-truck-fast text-orange-500"></i> ƒêang giao</div>
                        <div class="text-2xl font-bold text-gray-800" id="statShipping">0</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                        <div class="text-gray-400 text-xs uppercase font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-boxes-stacked text-purple-500"></i> S·∫£n ph·∫©m</div>
                        <div class="text-2xl font-bold text-gray-800" id="statProducts">0</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                        <h3 class="font-bold text-gray-800 flex items-center gap-2"><i class="fa-regular fa-clock text-gray-500"></i> ƒê∆°n h√†ng m·ªõi nh·∫•t</h3>
                        <button onclick="switchTab('orders')" class="text-xs font-bold text-[#ee4d2d] hover:underline">Xem t·∫•t c·∫£</button>
                    </div>
                    <div id="dashboardOrderList" class="divide-y divide-gray-100">
                        <div class="text-center py-8 text-gray-400 text-sm">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                    </div>
                </div>
            </div>

            <!-- ORDERS TAB -->
            <div id="tab-orders" class="p-4 md:p-8 overflow-y-auto h-full pb-20 hidden custom-scrollbar">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">Qu·∫£n L√Ω ƒê∆°n H√†ng</h2>
                    <div class="flex bg-white rounded-lg p-1 shadow-sm border border-gray-200 w-full md:w-auto overflow-x-auto">
                        <button onclick="loadOrders('all')" id="filter-all" class="flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition bg-gray-100 text-gray-800 whitespace-nowrap">T·∫•t c·∫£</button>
                        <button onclick="loadOrders('new')" id="filter-new" class="flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition text-gray-500 hover:bg-gray-50 whitespace-nowrap">ƒê∆°n m·ªõi</button>
                        <button onclick="loadOrders('shipping')" id="filter-shipping" class="flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition text-gray-500 hover:bg-gray-50 whitespace-nowrap">ƒêang giao</button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden min-h-[400px]">
                    <table class="w-full text-sm text-left text-gray-500 desktop-table">
                        <thead class="text-xs text-gray-500 uppercase bg-gray-50 border-b">
                            <tr>
                                <th class="px-6 py-3">M√£ ƒê∆°n</th>
                                <th class="px-6 py-3">Kh√°ch H√†ng</th>
                                <th class="px-6 py-3">Ng√†y ƒê·∫∑t</th>
                                <th class="px-6 py-3">T·ªïng Ti·ªÅn</th>
                                <th class="px-6 py-3">Tr·∫°ng Th√°i</th>
                                <th class="px-6 py-3 text-right">H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="orderTableBody" class="divide-y divide-gray-100"></tbody>
                    </table>
                    <div id="orderListMobile" class="md:hidden bg-gray-50 p-2 space-y-2"></div>
                </div>
            </div>

            <!-- PRODUCTS TAB (N√ÇNG C·∫§P GIAO DI·ªÜN CH·ªêNG B·∫§M NH·∫¶M) -->
            <div id="tab-products" class="p-4 md:p-8 overflow-y-auto h-full pb-20 hidden custom-scrollbar">
                <div class="flex justify-between items-center mb-6 sticky top-0 bg-[#f8fafc] z-10 py-2">
                    <h2 class="text-2xl font-bold text-gray-800">S·∫£n Ph·∫©m</h2>
                    <button onclick="openProductModal()" class="bg-[#ee4d2d] text-white px-4 py-2.5 rounded-lg shadow-lg shadow-orange-500/30 hover:bg-[#d73211] text-sm font-bold flex items-center gap-2 transition transform active:scale-95">
                        <i class="fa-solid fa-plus"></i> <span class="hidden md:inline">Th√™m S·∫£n Ph·∫©m</span>
                    </button>
                </div>
                
                <!-- PRODUCT GRID (Cards t·ªëi ∆∞u ch·ªëng b·∫•m nh·∫ßm) -->
                <div id="productList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Products Injected Here -->
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CHI TI·∫æT ƒê∆†N H√ÄNG (FULL C√îNG C·ª§) -->
    <div id="orderDetailModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col transform scale-95 transition-transform duration-200" id="orderDetailContent">
            <!-- Header Modal -->
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                    <i class="fa-solid fa-file-invoice text-[#ee4d2d]"></i> Chi Ti·∫øt ƒê∆°n H√†ng <span id="odIdHeader" class="text-sm font-mono bg-gray-200 px-2 py-0.5 rounded text-gray-600"></span>
                </h3>
                <button onclick="closeModal('orderDetailModal')" class="text-gray-400 hover:text-gray-600 w-8 h-8 rounded-full hover:bg-gray-200 flex items-center justify-center"><i class="fa-solid fa-times text-lg"></i></button>
            </div>
            
            <div class="p-6 overflow-y-auto custom-scrollbar flex-1 bg-white">
                <!-- Th√¥ng tin & C√¥ng c·ª• -->
                <div class="flex flex-col md:flex-row gap-6 mb-6">
                    <!-- C·ªôt Tr√°i: Th√¥ng tin kh√°ch -->
                    <div class="flex-1 space-y-3 text-sm bg-blue-50/50 p-4 rounded-lg border border-blue-100">
                        <div class="font-bold text-blue-800 border-b border-blue-200 pb-2 mb-2 uppercase text-xs tracking-wider flex items-center gap-2"><i class="fa-solid fa-user"></i> Kh√°ch h√†ng</div>
                        <p class="flex justify-between border-b border-dashed border-blue-200 pb-1"><span class="text-gray-500">H·ªç t√™n:</span> <span id="odName" class="font-bold text-gray-800"></span></p>
                        <p class="flex justify-between border-b border-dashed border-blue-200 pb-1"><span class="text-gray-500">SƒêT:</span> <span id="odPhone" class="font-bold text-[#ee4d2d]"></span></p>
                        <p class="flex flex-col"><span class="text-gray-500 mb-1">ƒê·ªãa ch·ªâ:</span> <span id="odAddress" class="font-medium text-gray-800 bg-white p-2 rounded border border-blue-100"></span></p>
                        <p class="flex flex-col"><span class="text-gray-500 mb-1">Ghi ch√∫:</span> <span id="odNote" class="italic text-gray-600 bg-yellow-50 px-2 py-1 rounded border border-yellow-100"></span></p>
                    </div>
                    
                    <!-- C·ªôt Ph·∫£i: C√¥ng c·ª• x·ª≠ l√Ω (4 N√∫t Quy·ªÅn L·ª±c) -->
                    <div class="flex-1 space-y-4">
                         <div class="grid grid-cols-2 gap-3">
                            <button onclick="printOrder()" class="bg-gray-700 text-white py-3 rounded-lg text-xs font-bold hover:bg-gray-800 flex flex-col items-center justify-center gap-1 shadow hover:shadow-md transition">
                                <i class="fa-solid fa-print text-lg"></i> In ƒê∆°n H√†ng
                            </button>
                            <button onclick="exportOrder()" class="bg-green-600 text-white py-3 rounded-lg text-xs font-bold hover:bg-green-700 flex flex-col items-center justify-center gap-1 shadow hover:shadow-md transition">
                                <i class="fa-solid fa-file-export text-lg"></i> Xu·∫•t File TXT
                            </button>
                            <button onclick="shareOrder('zalo')" class="bg-blue-500 text-white py-3 rounded-lg text-xs font-bold hover:bg-blue-600 flex flex-col items-center justify-center gap-1 shadow hover:shadow-md transition">
                                <i class="fa-solid fa-share-nodes text-lg"></i> G·ª≠i Nhanh Zalo
                            </button>
                            <button onclick="deleteOrder(event)" class="bg-red-50 text-red-600 border border-red-200 py-3 rounded-lg text-xs font-bold hover:bg-red-100 flex flex-col items-center justify-center gap-1 shadow-sm transition">
                                <i class="fa-solid fa-trash-can text-lg"></i> X√≥a ƒê∆°n H√†ng
                            </button>
                         </div>

                        <!-- Tr·∫°ng th√°i ƒë∆°n -->
                        <div class="bg-white p-3 rounded-lg border-2 border-dashed border-[#ee4d2d]/30">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô</label>
                            <div class="flex gap-2">
                                <select id="odStatusSelect" class="flex-1 border border-gray-300 p-2 rounded text-sm focus:border-[#ee4d2d] outline-none bg-gray-50">
                                    <option value="new">üÜï M·ªõi (Ch·ªù x√°c nh·∫≠n)</option>
                                    <option value="shipping">üöö ƒêang giao h√†ng</option>
                                    <option value="done">‚úÖ Ho√†n th√†nh</option>
                                    <option value="cancel">‚ùå ƒê√£ h·ªßy</option>
                                </select>
                                <button onclick="updateOrderStatus()" class="bg-[#ee4d2d] text-white px-4 py-2 rounded text-sm font-bold hover:bg-[#d73211] transition shadow-md">
                                    L∆∞u
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Danh s√°ch s·∫£n ph·∫©m -->
                <div class="font-bold text-gray-800 border-b pb-2 mb-3 uppercase text-xs tracking-wider flex justify-between">
                    <span>S·∫£n ph·∫©m ƒë·∫∑t mua (<span id="odItemCount">0</span>)</span>
                    <span id="odPayment" class="text-[#ee4d2d]"></span>
                </div>
                <div id="odItems" class="space-y-3 mb-6"></div>
                
                <!-- T·ªïng ti·ªÅn -->
                <div class="flex justify-end items-center pt-4 border-t border-gray-100">
                    <div class="text-right">
                        <div class="text-sm text-gray-500">Ph√≠ v·∫≠n chuy·ªÉn: <span id="odShip" class="font-medium text-gray-800"></span></div>
                        <div class="text-xl font-bold text-gray-800 mt-1">T·ªïng thanh to√°n: <span id="odTotal" class="text-[#ee4d2d] text-3xl"></span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL TH√äM/S·ª¨A S·∫¢N PH·∫®M -->
    <div id="productModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col transform scale-95 transition-transform duration-200" id="productModalContent">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg text-gray-800">Th√¥ng Tin S·∫£n Ph·∫©m</h3>
                <button onclick="closeModal('productModal')" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
                <form id="productForm" onsubmit="saveProduct(event)" class="space-y-5">
                    <input type="hidden" id="productId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div><label class="block text-sm font-bold text-gray-700 mb-1">T√™n s·∫£n ph·∫©m *</label><input type="text" id="pName" class="w-full border p-2 rounded focus:border-[#ee4d2d] outline-none" required></div>
                        <div><label class="block text-sm font-bold text-gray-700 mb-1">Gi√° c∆° b·∫£n (VNƒê) *</label><input type="number" id="pPrice" class="w-full border p-2 rounded focus:border-[#ee4d2d] outline-none" required></div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Link ·∫¢nh Ch√≠nh (URL) *</label>
                        <div class="flex gap-4 items-start"><div class="flex-1"><input type="text" id="pImg" class="w-full border p-2 rounded focus:border-[#ee4d2d] outline-none" oninput="document.getElementById('pImgPreview').src=this.value" required></div><img id="pImgPreview" src="https://via.placeholder.com/100" class="w-20 h-20 object-cover rounded border"></div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center mb-3"><label class="text-sm font-bold text-gray-700 flex items-center gap-2"><i class="fa-solid fa-layer-group text-blue-500"></i> Ph√¢n lo·∫°i h√†ng</label><button type="button" onclick="addVariantRow()" class="text-xs bg-blue-100 text-blue-600 px-3 py-1.5 rounded-full font-bold hover:bg-blue-200 transition">+ Th√™m</button></div>
                        <div id="variantContainer" class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2"></div>
                    </div>
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">M√¥ t·∫£</label><textarea id="pDesc" class="w-full border p-2 rounded focus:border-[#ee4d2d] outline-none h-24 text-sm"></textarea></div>
                    <div class="pt-4 border-t flex justify-end gap-3 sticky bottom-0 bg-white"><button type="button" onclick="closeModal('productModal')" class="px-5 py-2.5 bg-gray-100 rounded-lg text-gray-600 font-bold">H·ªßy</button><button type="submit" class="px-6 py-2.5 bg-[#ee4d2d] text-white rounded-lg font-bold hover:bg-[#d73211] shadow-lg">L∆∞u S·∫£n Ph·∫©m</button></div>
                </form>
            </div>
        </div>
    </div>

    <!-- AREA IN H√ìA ƒê∆†N (·∫®N) -->
    <div id="printArea" class="hidden"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDT0IEKhjAJZ_ZiMVwVCvO-fuj0ByReoE8",
            authDomain: "esomar-vnn.firebaseapp.com",
            projectId: "esomar-vnn",
            storageBucket: "esomar-vnn.firebasestorage.app",
            messagingSenderId: "1023271897973",
            appId: "1:1023271897973:web:c7207b0e8321fc271fe13c"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- MOBILE MENU LOGIC ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('sidebarBackdrop');
            if (sidebar.classList.contains('sidebar-closed')) {
                sidebar.classList.remove('sidebar-closed'); sidebar.classList.add('sidebar-open'); backdrop.classList.remove('hidden');
            } else {
                sidebar.classList.remove('sidebar-open'); sidebar.classList.add('sidebar-closed'); backdrop.classList.add('hidden');
            }
        }

        // --- AUTH ---
        function checkAuth() {
            auth.signInAnonymously().then(() => {
                const isAuth = localStorage.getItem('mimi_admin_auth');
                if(isAuth === 'true') { document.getElementById('loginOverlay').classList.add('hidden'); switchTab('dashboard'); } 
                else { document.getElementById('loginOverlay').classList.remove('hidden'); }
            });
        }
        function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('username').value; const p = document.getElementById('password').value;
            if(u === 'admin' && p === 'admin123') { localStorage.setItem('mimi_admin_auth', 'true'); document.getElementById('loginOverlay').classList.add('hidden'); switchTab('dashboard'); } 
            else alert('Sai th√¥ng tin!');
        }
        function logout() { if(confirm("ƒêƒÉng xu·∫•t?")) { localStorage.removeItem('mimi_admin_auth'); window.location.reload(); } }

        // --- MAIN LOGIC ---
        function switchTab(tabId) {
            document.querySelectorAll('nav a').forEach(a => a.classList.remove('active-nav'));
            if(document.getElementById(`nav-${tabId}`)) document.getElementById(`nav-${tabId}`).classList.add('active-nav');
            ['dashboard', 'orders', 'products'].forEach(t => document.getElementById(`tab-${t}`).classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            if(tabId === 'dashboard') loadDashboard();
            if(tabId === 'orders') loadOrders();
            if(tabId === 'products') loadProducts();
        }

        // --- DASHBOARD ---
        function loadDashboard() {
            db.collection("orders").orderBy("createdAt", "desc").limit(50).onSnapshot(snap => {
                let revenue = 0, newOrders = 0, shipping = 0, html = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    if(d.status === 'done') revenue += (d.total || 0);
                    if(d.status === 'new') newOrders++;
                    if(d.status === 'shipping') shipping++;
                    if(html.length < 2000) {
                        html += `<div class="p-4 flex justify-between items-center hover:bg-gray-50 cursor-pointer transition" onclick="switchTab('orders'); setTimeout(() => viewOrder('${doc.id}'), 100)"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center font-bold text-xs">${d.customer?.name?d.customer.name.charAt(0).toUpperCase():'#'}</div><div><div class="font-bold text-sm text-gray-800 line-clamp-1">${d.customer?.name}</div><div class="text-xs text-gray-400">${getTimeAgo(d.createdAt?.toDate())}</div></div></div><div class="text-right"><div class="font-bold text-[#ee4d2d] text-sm">${formatMoney(d.total)}</div><div class="text-[10px] uppercase font-bold px-2 py-0.5 rounded ${getStatusColor(d.status)} inline-block">${getStatusText(d.status)}</div></div></div>`;
                    }
                });
                document.getElementById('statRevenue').innerText = formatMoney(revenue);
                document.getElementById('statNewOrders').innerText = newOrders;
                document.getElementById('statShipping').innerText = shipping;
                document.getElementById('dashboardOrderList').innerHTML = html || '<div class="p-4 text-center text-gray-400 text-sm">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</div>';
                const badge = document.getElementById('badgeNewOrders');
                if(newOrders>0){ badge.innerText=newOrders; badge.classList.remove('hidden'); } else badge.classList.add('hidden');
            });
            db.collection("products").get().then(snap => document.getElementById('statProducts').innerText = snap.size);
        }

        // --- ORDERS ---
        let currentOrderData = null; let currentOrderId = null; let orderUnsub = null;
        function loadOrders(filter = 'all') {
            const tbody = document.getElementById('orderTableBody'); const mobList = document.getElementById('orderListMobile');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8"><div class="loader mx-auto"></div></td></tr>';
            document.querySelectorAll('#tab-orders button').forEach(b => { b.classList.remove('bg-blue-100', 'text-blue-700'); b.classList.add('bg-gray-100'); });
            const btn = document.getElementById(`filter-${filter}`); if(btn) { btn.classList.remove('bg-gray-100'); btn.classList.add('bg-blue-100', 'text-blue-700'); }
            let query = db.collection("orders").orderBy("createdAt", "desc");
            if(filter !== 'all') query = query.where("status", "==", filter);
            if(orderUnsub) orderUnsub();
            orderUnsub = query.limit(50).onSnapshot(snap => {
                let htmlPC = '', htmlMob = '';
                if(snap.empty) { const e = '<div class="text-center py-10 text-gray-400">Kh√¥ng c√≥ ƒë∆°n h√†ng</div>'; tbody.innerHTML = `<tr><td colspan="6">${e}</td></tr>`; mobList.innerHTML = e; return; }
                snap.forEach(doc => {
                    const d = doc.data(); const date = d.createdAt ? formatDate(d.createdAt.toDate()) : '';
                    const badge = `<span class="px-2 py-1 rounded-md text-xs font-bold ${getStatusColor(d.status)} border border-white/50 shadow-sm">${getStatusText(d.status)}</span>`;
                    htmlPC += `<tr class="bg-white border-b hover:bg-blue-50/50 transition cursor-pointer" onclick="viewOrder('${doc.id}')"><td class="px-6 py-4 font-mono text-xs text-gray-500">#${doc.id.slice(-6).toUpperCase()}</td><td class="px-6 py-4"><div class="font-bold text-gray-800 text-sm">${d.customer?.name}</div><div class="text-xs text-gray-500">${d.customer?.phone}</div></td><td class="px-6 py-4 text-xs text-gray-600">${date}</td><td class="px-6 py-4 font-bold text-[#ee4d2d]">${formatMoney(d.total)}</td><td class="px-6 py-4">${badge}</td><td class="px-6 py-4 text-right"><button class="text-gray-400 hover:text-blue-600 px-2"><i class="fa-solid fa-eye"></i></button></td></tr>`;
                    htmlMob += `<div class="mobile-card" onclick="viewOrder('${doc.id}')"><div class="flex justify-between items-start mb-3 border-b border-dashed pb-2 border-gray-100"><div class="flex items-center gap-2"><span class="font-mono text-xs font-bold text-gray-500 bg-gray-100 px-1 rounded">#${doc.id.slice(-6).toUpperCase()}</span><span class="text-xs text-gray-400">${getTimeAgo(d.createdAt?.toDate())}</span></div>${badge}</div><div class="flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded bg-blue-50 flex items-center justify-center text-blue-500 text-lg"><i class="fa-solid fa-user"></i></div><div><div class="text-sm font-bold text-gray-800">${d.customer?.name}</div><div class="text-xs text-gray-500">${d.customer?.phone}</div></div></div><div class="text-lg font-bold text-[#ee4d2d]">${formatMoney(d.total)}</div></div></div>`;
                });
                tbody.innerHTML = htmlPC; mobList.innerHTML = htmlMob;
            });
        }
        function viewOrder(id) {
            currentOrderId = id;
            db.collection("orders").doc(id).get().then(doc => {
                if(!doc.exists) return;
                const d = doc.data(); currentOrderData = d; currentOrderData.id = id;
                document.getElementById('odIdHeader').innerText = `#${id.slice(-6).toUpperCase()}`;
                document.getElementById('odName').innerText = d.customer?.name;
                document.getElementById('odPhone').innerText = d.customer?.phone;
                document.getElementById('odAddress').innerText = d.customer?.fullAddress || d.customer?.address;
                document.getElementById('odNote').innerText = d.customer?.note || 'Kh√¥ng c√≥';
                document.getElementById('odPayment').innerText = d.paymentMethod === 'banking' ? 'Chuy·ªÉn kho·∫£n' : 'COD';
                document.getElementById('odStatusSelect').value = d.status;
                document.getElementById('odTotal').innerText = formatMoney(d.total);
                document.getElementById('odShip').innerText = formatMoney(d.shippingFee || 0);
                document.getElementById('odItemCount').innerText = d.items ? d.items.length : 0;
                const itemsContainer = document.getElementById('odItems'); itemsContainer.innerHTML = '';
                if(d.items) d.items.forEach(item => { itemsContainer.innerHTML += `<div class="flex gap-3 bg-gray-50 p-2 rounded border border-gray-100"><div class="w-12 h-12 shrink-0 bg-white rounded border overflow-hidden"><img src="${item.image||'https://via.placeholder.com/50'}" class="w-full h-full object-cover"></div><div class="flex-1 min-w-0"><div class="text-sm font-medium text-gray-800 line-clamp-1">${item.name}</div><div class="text-xs text-gray-500 mt-0.5">Ph√¢n lo·∫°i: <span class="font-bold">${item.variant}</span></div><div class="flex justify-between items-center mt-1"><span class="text-xs bg-white border px-1.5 rounded text-gray-600">x${item.qty}</span><span class="text-sm font-bold text-[#ee4d2d]">${formatMoney(item.price)}</span></div></div></div>`; });
                const modal = document.getElementById('orderDetailModal'); const content = document.getElementById('orderDetailContent');
                modal.classList.remove('hidden'); requestAnimationFrame(() => { modal.classList.remove('opacity-0'); content.classList.remove('scale-95'); content.classList.add('scale-100'); });
            });
        }

        // --- ACTIONS ---
        function updateOrderStatus() { db.collection("orders").doc(currentOrderId).update({ status: document.getElementById('odStatusSelect').value }).then(() => { alert("ƒê√£ c·∫≠p nh·∫≠t!"); closeModal('orderDetailModal'); }); }
        function deleteOrder(event) {
            if(navigator.vibrate) navigator.vibrate(50);
            if(confirm("X√ìA Vƒ®NH VI·ªÑN ƒë∆°n n√†y?")) {
                const btn = event.target.closest('button'); const old = btn.innerHTML; btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> X√≥a...'; btn.disabled=true;
                db.collection("orders").doc(currentOrderId).delete().then(() => { alert("ƒê√£ x√≥a!"); closeModal('orderDetailModal'); }).catch(err => { alert("L·ªói x√≥a ƒë∆°n!"); btn.innerHTML=old; btn.disabled=false; });
            }
        }
        function printOrder() {
            const d = currentOrderData; const w = window.open('', '_blank'); let itemsHtml = '';
            d.items.forEach(i => { itemsHtml += `<tr style="border-bottom:1px dashed #ddd"><td style="padding:5px 0">${i.name}<br><small>${i.variant}</small></td><td style="text-align:center">${i.qty}</td><td style="text-align:right">${formatMoney(i.price*i.qty)}</td></tr>`; });
            w.document.write(`<html><head><title>H√≥a ƒë∆°n</title><style>body{font-family:Arial,sans-serif;width:80mm;margin:0 auto;padding:10px}h2{text-align:center;margin:0 0 5px 0}.info{font-size:12px;margin-bottom:10px}table{width:100%;font-size:12px;border-collapse:collapse}th{text-align:left;border-bottom:1px solid #000}.total{text-align:right;font-weight:bold;margin-top:10px;font-size:14px}</style></head><body><h2>MIMI FLOWER</h2><div class="info">KH: ${d.customer.name}<br>SƒêT: ${d.customer.phone}<br>ƒêC: ${d.customer.fullAddress}</div><table><thead><tr><th>SP</th><th>SL</th><th>Ti·ªÅn</th></tr></thead><tbody>${itemsHtml}</tbody></table><div class="total">T·ªïng: ${formatMoney(d.total)}</div><div style="text-align:center;margin-top:20px;font-size:10px">C·∫£m ∆°n qu√Ω kh√°ch!</div><script>window.print();<\/script></body></html>`); w.document.close();
        }
        function exportOrder() {
            const d = currentOrderData; let text = `\uFEFFƒê∆†N H√ÄNG #${d.id.slice(-6).toUpperCase()}\n----------------\nKH: ${d.customer.name}\nSƒêT: ${d.customer.phone}\nƒêC: ${d.customer.fullAddress}\n----------------\n`;
            d.items.forEach(i => { text += `- ${i.name} (${i.variant}) x${i.qty} = ${formatMoney(i.price*i.qty)}\n`; }); text += `----------------\nT·ªîNG: ${formatMoney(d.total)}`;
            const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([text], {type: "text/plain;charset=utf-8"})); a.download = `Don_${d.customer.name}.txt`; a.click();
        }
        function shareOrder(platform) {
            const d = currentOrderData; let text = `ƒê∆°n m·ªõi: ${d.customer.name} - ${d.customer.phone}\nƒêC: ${d.customer.fullAddress}\nH√†ng:\n`;
            d.items.forEach(i => { text += `- ${i.name} (${i.variant}) x${i.qty}\n`; }); text += `T·ªïng: ${formatMoney(d.total)}`;
            navigator.clipboard.writeText(text).then(() => { alert("ƒê√£ copy n·ªôi dung! ƒêang m·ªü Zalo..."); window.open('https://chat.zalo.me/', '_blank'); });
        }

        // --- PRODUCTS LOGIC (OPTIMIZED UI) ---
        function loadProducts() {
            const grid = document.getElementById('productList');
            grid.innerHTML = '<div class="loader mx-auto col-span-full"></div>';
            db.collection("products").orderBy("createdAt", "desc").get().then(snap => {
                let html = '';
                snap.forEach(doc => {
                    const p = doc.data();
                    html += `
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition relative group">
                        <div class="absolute top-2 right-2 z-10">
                            <button onclick="deleteProduct('${doc.id}')" class="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 transition transform active:scale-90"><i class="fa-solid fa-trash text-sm"></i></button>
                        </div>
                        <div class="aspect-square bg-gray-100 relative">
                            <img src="${p.images?.[0] || 'https://via.placeholder.com/150'}" class="w-full h-full object-cover" loading="lazy">
                        </div>
                        <div class="p-3">
                            <h3 class="font-bold text-gray-800 line-clamp-1 text-sm mb-1">${p.name}</h3>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-[#ee4d2d] font-bold text-sm">${formatMoney(p.basePrice)}</span>
                                <span class="text-[10px] text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded">${p.variants?.length||0} lo·∫°i</span>
                            </div>
                            <button onclick="editProduct('${doc.id}')" class="w-full bg-blue-50 text-blue-600 py-2 rounded-lg text-sm font-bold hover:bg-blue-100 transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-pen"></i> Ch·ªânh S·ª≠a
                            </button>
                        </div>
                    </div>`;
                });
                grid.innerHTML = html;
            });
        }
        function openProductModal() { document.getElementById('productForm').reset(); document.getElementById('productId').value=''; document.getElementById('variantContainer').innerHTML=''; document.getElementById('productModal').classList.remove('hidden'); }
        function closeModal(id) { const modal = document.getElementById(id); const content = modal.firstElementChild; modal.classList.add('opacity-0'); if(content) content.classList.remove('scale-100'); setTimeout(() => modal.classList.add('hidden'), 200); }
        function formatMoney(n) { return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(n); }
        function formatDate(d) { return d ? d.toLocaleString('vi-VN', { day: '2-digit', month: '2-digit', hour: '2-digit', minute:'2-digit' }) : ''; }
        function getTimeAgo(date) { if(!date) return ''; const s = Math.floor((new Date()-date)/1000); if(s<60) return 'V·ª´a xong'; const m=Math.floor(s/60); if(m<60) return `${m} ph√∫t tr∆∞·ªõc`; const h=Math.floor(m/60); if(h<24) return `${h} gi·ªù tr∆∞·ªõc`; return formatDate(date); }
        function getStatusText(s) { const map = { 'new': 'M·ªõi', 'shipping': 'ƒêang giao', 'done': 'Ho√†n th√†nh', 'cancel': 'ƒê√£ h·ªßy' }; return map[s] || s; }
        function getStatusColor(s) { const map = { 'new': 'bg-blue-100 text-blue-700', 'shipping': 'bg-orange-100 text-orange-700', 'done': 'bg-green-100 text-green-700', 'cancel': 'bg-red-100 text-red-800' }; return map[s] || 'bg-gray-100'; }
        
        function editProduct(id) { db.collection("products").doc(id).get().then(doc => { if(doc.exists) { const p = doc.data(); document.getElementById('productId').value=id; document.getElementById('pName').value=p.name; document.getElementById('pPrice').value=p.basePrice; document.getElementById('pImg').value=p.images[0]; document.getElementById('pDesc').value=p.description; const c = document.getElementById('variantContainer'); c.innerHTML=''; if(p.variants) p.variants.forEach(v=>addVariantRow(v.name,v.price,v.image)); document.getElementById('productModal').classList.remove('hidden'); }}); }
        function addVariantRow(n='',p='',i='') { const d=document.createElement('div'); d.className='flex gap-2 mb-2'; d.innerHTML=`<input class="v-name border p-1 w-1/3 rounded" placeholder="T√™n" value="${n}"><input class="v-price border p-1 w-1/4 rounded" type="number" placeholder="Gi√°" value="${p}"><input class="v-img border p-1 w-1/3 rounded" placeholder="·∫¢nh" value="${i}"><button type="button" onclick="this.parentElement.remove()" class="text-red-500"><i class="fa-solid fa-trash"></i></button>`; document.getElementById('variantContainer').appendChild(d); }
        window.saveProduct = function(e) { e.preventDefault(); const id = document.getElementById('productId').value; const vs = []; document.querySelectorAll('#variantContainer > div').forEach(r => { vs.push({name: r.querySelector('.v-name').value, price: parseInt(r.querySelector('.v-price').value), image: r.querySelector('.v-img').value}); }); const d = { name: document.getElementById('pName').value, basePrice: parseInt(document.getElementById('pPrice').value), description: document.getElementById('pDesc').value, images: [document.getElementById('pImg').value], variants: vs, createdAt: firebase.firestore.FieldValue.serverTimestamp() }; if(id) { delete d.createdAt; db.collection("products").doc(id).update(d).then(() => { alert("ƒê√£ l∆∞u!"); closeModal('productModal'); loadProducts(); }); } else { db.collection("products").add(d).then(() => { alert("ƒê√£ th√™m!"); closeModal('productModal'); loadProducts(); }); } };
        function deleteProduct(id) { if(confirm("X√≥a s·∫£n ph·∫©m?")) db.collection("products").doc(id).delete().then(loadProducts); }

        window.onload = checkAuth;
    </script>
</body>
</html>
